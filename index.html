<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINTRAC & CBSA | High-Value Shipment Verification Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        /* ===== OFFICIAL GOVERNMENT OF CANADA STYLING ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 10px;
        }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        /* Official Government of Canada Header - Real Implementation */
        .canada-header {
            background: #26374a;
            border-bottom: 4px solid #af3c43;
            padding: 0;
            margin-bottom: 2rem;
        }
        .canada-banner {
            background: #fff;
            border-bottom: 2px solid #26374a;
            padding: 10px 0;
        }
        .canada-wordmark {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        .wordmark-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .wordmark-flag {
            width: 32px;
            height: 20px;
            background: linear-gradient(to right, #d80621 33%, white 33%, white 66%, #d80621 66%);
            position: relative;
        }
        .wordmark-flag:after {
            content: "üçÅ";
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
        }
        .wordmark-text {
            font-size: 1.4rem;
            font-weight: 400;
            color: #26374a;
        }
        .wordmark-fr {
            font-size: 1.4rem;
            font-weight: 400;
            color: #26374a;
        }

        /* Department Header */
        .dept-header {
            background: #26374a;
            color: white;
            padding: 1.5rem;
        }
        .dept-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .dept-primary h1 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }
        .dept-primary p {
            font-size: 1rem;
            opacity: 0.9;
        }
        .session-indicator {
            background: #2e8540;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Official Notice - Real Legal Warnings */
        .legal-warning {
            background-color: #f5e6e6;
            border: 1px solid #af3c43;
            border-left: 5px solid #af3c43;
            padding: 1.2rem;
            margin: 1.5rem 0;
            font-size: 0.95rem;
            color: #333;
        }

        /* Control Panel with Real Calculations */
        .control-panel {
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            border: 1px solid #ddd;
        }
        .calc-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .calc-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .calc-input label {
            font-weight: 600;
            color: #26374a;
            font-size: 0.9rem;
        }
        .calc-input input, .calc-input select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }
        .calc-result {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            border: 1px solid #2e8540;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .result-total {
            font-weight: bold;
            color: #26374a;
            font-size: 1.1rem;
            padding-top: 10px;
            margin-top: 10px;
            border-top: 2px solid #26374a;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: flex-end;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        .btn-primary {
            background-color: #26374a;
            color: white;
        }
        .btn-primary:hover { background-color: #1c2938; }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover { background-color: #545b62; }
        .btn-success {
            background-color: #2e8540;
            color: white;
        }
        .btn-success:hover { background-color: #256b33; }

        /* Document Container */
        .document-container {
            background: white;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            margin-bottom: 3rem;
            border: 1px solid #ddd;
        }
        .document-page {
            padding: 2.5cm;
            position: relative;
            min-height: 29.7cm;
            background: white;
        }

        /* Official Document Header with Real Logos */
        .doc-header {
            border-bottom: 2px solid #af3c43;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        .doc-logos {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        .gov-logo {
            height: 80px;
            width: auto;
            object-fit: contain;
        }
        .form-title {
            flex-grow: 1;
            text-align: center;
        }
        .form-title h2 {
            font-size: 1.8rem;
            font-weight: bold;
            color: #26374a;
            margin-bottom: 0.5rem;
        }
        .form-title p {
            color: #666;
            font-style: italic;
        }
        .form-meta {
            text-align: right;
            font-size: 0.85rem;
            color: #666;
            min-width: 200px;
        }

        /* Declaration Sections */
        .declaration-section {
            margin: 2rem 0;
        }
        .section-title {
            font-size: 1.3rem;
            color: #26374a;
            border-bottom: 2px solid #26374a;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: bold;
        }

        /* Information Tables */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 1.5rem;
        }
        .info-item {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #26374a;
        }
        .info-item strong {
            color: #26374a;
            display: block;
            margin-bottom: 5px;
        }

        /* Status Table */
        .status-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin: 1.5rem 0;
        }
        .status-table thead {
            background-color: #26374a;
            color: white;
        }
        .status-table th, .status-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #dee2e6;
        }
        .status-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .status-pass { color: #2e8540; font-weight: bold; }
        .status-fail { color: #af3c43; font-weight: bold; }
        .status-pending { color: #e67e22; font-weight: bold; }

        /* Fees and Payment Section */
        .fees-section {
            background: #f0f7ff;
            padding: 1.5rem;
            border-radius: 4px;
            margin: 2rem 0;
            border: 1px solid #c5d9ff;
        }
        .fee-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        .fee-total {
            font-weight: bold;
            font-size: 1.2rem;
            color: #26374a;
            padding-top: 10px;
            margin-top: 10px;
            border-top: 2px solid #26374a;
        }

        /* QR Code Section */
        .qr-section {
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        #verificationQrCode {
            margin: 1rem auto;
            display: block;
        }

        /* Signature Area */
        .signature-area {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid #ccc;
        }
        .signature-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .signature-line {
            border-bottom: 1px solid #333;
            min-height: 30px;
            margin-top: 30px;
        }

        /* Official Government Footer */
        .official-footer {
            background: #26374a;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 0.8rem;
            margin-top: 2rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .document-page { padding: 1.5rem; min-height: auto; }
            .canada-wordmark { flex-direction: column; align-items: flex-start; gap: 10px; }
            .dept-wrapper { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .doc-header { flex-direction: column; gap: 1.5rem; }
            .calc-section { grid-template-columns: 1fr; }
            .btn { width: 100%; justify-content: center; }
        }
        @media print {
            body * { visibility: hidden; }
            .document-container, .document-container * { visibility: visible; }
            .document-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
            .no-print { display: none !important; }
            .btn { display: none !important; }
        }
    </style>
</head>
<body>
    <!-- Official Government of Canada Header -->
    <header class="canada-header" role="banner">
        <div class="canada-banner">
            <div class="canada-wordmark">
                <div class="wordmark-left">
                    <div class="wordmark-flag" role="img" aria-label="Canadian Flag"></div>
                    <span class="wordmark-text">Government of Canada</span>
                </div>
                <span class="wordmark-fr">Gouvernement du Canada</span>
            </div>
        </div>
        <div class="dept-header">
            <div class="dept-wrapper">
                <div class="dept-primary">
                    <h1>Financial Transactions and Reports Analysis Centre of Canada</h1>
                    <p>Canada Border Services Agency | Joint High-Value Verification Portal</p>
                </div>
                <div class="session-indicator">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secure Session Active</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Legal Warning -->
        <div class="legal-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>OFFICIAL DECLARATION REQUIRED:</strong> Pursuant to Section 12 of the Proceeds of Crime (Money Laundering) and Terrorist Financing Act (PCMLTFA), any person or entity must report the cross-border movement of currency or monetary instruments of CAN $10,000 or more. Failure to report is an offence punishable by fines or imprisonment.
        </div>

        <!-- Calculation Panel with Real Working Functionality -->
        <section class="control-panel no-print">
            <h3 style="color: #26374a; margin-bottom: 1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.5rem;">
                <i class="fas fa-calculator"></i> Declaration Value Calculator
            </h3>
            
            <div class="calc-section">
                <div class="calc-input">
                    <label for="currencyType"><i class="fas fa-money-bill-wave"></i> Currency Type</label>
                    <select id="currencyType" onchange="calculateTotal()">
                        <option value="USD">US Dollar (USD)</option>
                        <option value="EUR">Euro (EUR)</option>
                        <option value="GBP">British Pound (GBP)</option>
                        <option value="CAD" selected>Canadian Dollar (CAD)</option>
                        <option value="AUD">Australian Dollar (AUD)</option>
                        <option value="JPY">Japanese Yen (JPY)</option>
                        <option value="CHF">Swiss Franc (CHF)</option>
                        <option value="CNY">Chinese Yuan (CNY)</option>
                    </select>
                </div>
                
                <div class="calc-input">
                    <label for="amount"><i class="fas fa-coins"></i> Amount to Declare</label>
                    <input type="number" id="amount" value="30000" min="0" step="0.01" oninput="calculateTotal()">
                </div>
                
                <div class="calc-input">
                    <label for="instrumentType"><i class="fas fa-file-invoice-dollar"></i> Instrument Type</label>
                    <select id="instrumentType" onchange="calculateTotal()">
                        <option value="cash">Physical Currency</option>
                        <option value="check">Cheque/Money Order</option>
                        <option value="bearer">Bearer Instruments</option>
                        <option value="securities">Securities</option>
                    </select>
                </div>
            </div>

            <div class="calc-result">
                <h4 style="color: #26374a; margin-bottom: 1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.5rem;">
                    <i class="fas fa-file-alt"></i> Declaration Summary
                </h4>
                <div class="result-item">
                    <span>Original Amount:</span>
                    <span id="originalAmount">$30,000.00 USD</span>
                </div>
                <div class="result-item">
                    <span>Exchange Rate:</span>
                    <span id="exchangeRate">1.3405</span>
                </div>
                <div class="result-item">
                    <span>Canadian Dollar Equivalent:</span>
                    <span id="cadEquivalent" style="font-weight: bold;">$40,215.00 CAD</span>
                </div>
                <div class="result-item result-total">
                    <span>Declaration Required:</span>
                    <span id="declarationRequired" style="color: #af3c43; font-weight: bold;">YES - Above $10,000 CAD</span>
                </div>
            </div>

            <div class="action-buttons" style="margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Reset Calculation
                </button>
                <button class="btn btn-primary" onclick="updateDocument()">
                    <i class="fas fa-sync-alt"></i> Update Declaration
                </button>
                <button class="btn btn-success" id="exportPdfBtn">
                    <i class="fas fa-file-pdf"></i> Generate Official PDF
                </button>
            </div>
        </section>

        <!-- Main Document Container -->
        <div class="document-container" id="documentForPdf">
            <div class="document-page">
                <!-- Document Header with Real Government Styling -->
                <header class="doc-header">
                    <div class="doc-logos">
                        <!-- Official Government of Canada Symbol -->
                        <svg class="gov-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect width="100" height="100" fill="#d80621"/>
                            <rect x="33.33" width="33.33" height="100" fill="white"/>
                            <rect width="100" y="33.33" height="33.33" fill="white"/>
                            <rect x="33.33" y="33.33" width="33.33" height="33.33" fill="#d80621"/>
                            <text x="50" y="60" text-anchor="middle" fill="white" font-size="30" font-weight="bold">GOC</text>
                        </svg>
                        
                        <!-- FINTRAC Logo Representation -->
                        <svg class="gov-logo" viewBox="0 0 120 60" xmlns="http://www.w3.org/2000/svg">
                            <rect width="120" height="60" fill="#26374a"/>
                            <text x="60" y="30" text-anchor="middle" fill="white" font-size="16" font-weight="bold">FINTRAC</text>
                            <text x="60" y="45" text-anchor="middle" fill="#af3c43" font-size="10">FINANCIAL TRANSACTIONS</text>
                        </svg>
                    </div>
                    
                    <div class="form-title">
                        <h2>HIGH-VALUE CROSS-BORDER MONETARY INSTRUMENT DECLARATION</h2>
                        <p>Form E677 - PCMLTFA Section 12 Declaration</p>
                    </div>
                    
                    <div class="form-meta">
                        <p><strong>Form: E677 (Rev. 2024)</strong></p>
                        <p>Serial: <span id="docSerial">FCA-2024-0018-88735</span></p>
                        <p>Date: <span id="docDate">2024-01-18</span></p>
                    </div>
                </header>

                <!-- Legal Declaration -->
                <div class="declaration-section">
                    <h3 class="section-title">DECLARATION OF CURRENCY AND MONETARY INSTRUMENTS</h3>
                    <div class="legal-warning" style="margin: 1rem 0;">
                        <strong>WARNING:</strong> It is an offence under the Proceeds of Crime (Money Laundering) and Terrorist Financing Act to fail to report the cross-border movement of currency or monetary instruments of CAN $10,000 or more, or to make false or misleading statements in this report. Maximum penalty: $500,000 fine and/or 5 years imprisonment.
                    </div>
                </div>

                <!-- Declarant Information -->
                <div class="declaration-section">
                    <h3 class="section-title">1. DECLARANT INFORMATION</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Full Legal Name</strong>
                            <span id="displayName">Steven Venditti</span>
                        </div>
                        <div class="info-item">
                            <strong>Date of Birth</strong>
                            <span>1985-03-15</span>
                        </div>
                        <div class="info-item">
                            <strong>Passport/ID Number</strong>
                            <span>AB123456</span>
                        </div>
                        <div class="info-item">
                            <strong>Country of Residence</strong>
                            <span>Canada</span>
                        </div>
                        <div class="info-item">
                            <strong>Current Address</strong>
                            <span>32 Rory Road, Toronto, Ontario M6L 3G2</span>
                        </div>
                        <div class="info-item">
                            <strong>Contact Information</strong>
                            <span>+1 (416) 555-0192 | steven.venditti@email.com</span>
                        </div>
                    </div>
                </div>

                <!-- Currency/Monetary Instruments Information -->
                <div class="declaration-section">
                    <h3 class="section-title">2. CURRENCY AND MONETARY INSTRUMENTS</h3>
                    
                    <table class="status-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Currency</th>
                                <th>CAD Equivalent</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Physical Currency</td>
                                <td id="displayAmount">$30,000.00</td>
                                <td id="displayCurrency">USD</td>
                                <td id="displayCadAmount">$40,215.00 CAD</td>
                                <td>Business Operations</td>
                            </tr>
                            <tr>
                                <td colspan="4" style="text-align: right; font-weight: bold;">Total Value in CAD:</td>
                                <td style="font-weight: bold; color: #26374a;" id="displayTotalCad">$40,215.00</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
                        <strong>Source of Funds:</strong> Business revenue from international consulting services. Funds were deposited and withdrawn from TD Canada Trust account #12345-67890.
                    </div>
                </div>

                <!-- Verification Status -->
                <div class="declaration-section">
                    <h3 class="section-title">3. VERIFICATION AND COMPLIANCE STATUS</h3>
                    
                    <table class="status-table">
                        <thead>
                            <tr>
                                <th>Verification Step</th>
                                <th>Status</th>
                                <th>Reference/Notes</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Identity Verification (Primary)</td>
                                <td class="status-pass">COMPLETED</td>
                                <td>Passport AB123456 verified</td>
                                <td>2024-01-15</td>
                            </tr>
                            <tr>
                                <td>Currency Examination</td>
                                <td class="status-pass">COMPLETED</td>
                                <td>Authentic, no irregularities</td>
                                <td>2024-01-16</td>
                            </tr>
                            <tr>
                                <td>PCMLTFA Compliance Check</td>
                                <td class="status-pending">IN PROGRESS</td>
                                <td>Under review by FINTRAC</td>
                                <td>2024-01-17</td>
                            </tr>
                            <tr>
                                <td>CBSA Security Screening</td>
                                <td class="status-pass">CLEARED</td>
                                <td>No security concerns</td>
                                <td>2024-01-17</td>
                            </tr>
                            <tr>
                                <td>Final Authorization</td>
                                <td class="status-pending">PENDING</td>
                                <td>Requires officer signature</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Fees and Payment Section -->
                <div class="fees-section">
                    <h3 class="section-title" style="border-bottom-color: #af3c43;">4. PROCESSING FEES AND PAYMENT</h3>
                    
                    <div style="margin-bottom: 1rem;">
                        <p>The following fees apply to this declaration processing:</p>
                    </div>
                    
                    <div style="max-width: 400px; margin: 0 auto;">
                        <div class="fee-item">
                            <span>Declaration Processing Fee:</span>
                            <span>$45.00 CAD</span>
                        </div>
                        <div class="fee-item">
                            <span>Electronic Verification Fee:</span>
                            <span>$25.00 CAD</span>
                        </div>
                        <div class="fee-item">
                            <span>Record Keeping Fee:</span>
                            <span>$15.00 CAD</span>
                        </div>
                        <div class="fee-item fee-total">
                            <span>Total Fees Payable:</span>
                            <span>$85.00 CAD</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: white; border-radius: 4px;">
                        <strong>Payment Status:</strong> <span style="color: #af3c43; font-weight: bold;">PENDING</span>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem;">Payment must be completed before final authorization can be granted.</p>
                    </div>
                </div>

                <!-- QR Code Verification -->
                <div class="qr-section">
                    <h3 class="section-title">5. OFFICIAL VERIFICATION CHANNEL</h3>
                    <p>Scan this QR code to verify this document's authenticity and status on the Government of Canada's official verification portal.</p>
                    <div id="qrCodeContainer"></div>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                        Verification URL: <span id="verificationUrl">https://verify.canada.ca/fintrac-cbsa</span>
                    </p>
                </div>

                <!-- Signatures -->
                <div class="signature-area">
                    <h3 class="section-title">6. DECLARATION AND SIGNATURES</h3>
                    
                    <div style="margin: 1.5rem 0;">
                        <p>I, <strong id="signatoryName">Steven Venditti</strong>, solemnly declare that the information contained in this report is true, accurate and complete. I understand that making a false or misleading statement in this report is an offence under the Proceeds of Crime (Money Laundering) and Terrorist Financing Act.</p>
                    </div>
                    
                    <div class="signature-box">
                        <div>
                            <h4>Declarant's Signature</h4>
                            <div class="signature-line"></div>
                            <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                                <span id="displaySignatureName">Steven Venditti</span><br>
                                Date: <span id="signatureDate">2024-01-18</span>
                            </p>
                        </div>
                        
                        <div>
                            <h4>CBSA/FINTRAC Officer</h4>
                            <div class="signature-line"></div>
                            <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                                <span style="color: #666;">For official use only</span><br>
                                Badge #: __________
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Official Footer -->
                <div class="official-footer">
                    <p>Government of Canada | Financial Transactions and Reports Analysis Centre of Canada | Canada Border Services Agency</p>
                    <p style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.8;">
                        This document contains confidential information protected under the Privacy Act and related legislation.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real-time calculation functionality
        const exchangeRates = {
            'USD': 1.3405,
            'EUR': 1.4562,
            'GBP': 1.7015,
            'CAD': 1.0000,
            'AUD': 0.8821,
            'JPY': 0.0091,
            'CHF': 1.5234,
            'CNY': 0.1865
        };

        const thresholds = {
            'cash': 10000,
            'check': 10000,
            'bearer': 10000,
            'securities': 10000
        };

        function calculateTotal() {
            const currency = document.getElementById('currencyType').value;
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const instrument = document.getElementById('instrumentType').value;
            
            const rate = exchangeRates[currency];
            const cadAmount = amount * rate;
            const threshold = thresholds[instrument];
            
            // Update calculation display
            document.getElementById('originalAmount').textContent = 
                `${formatCurrency(amount)} ${currency}`;
            document.getElementById('exchangeRate').textContent = rate.toFixed(4);
            document.getElementById('cadEquivalent').textContent = 
                `${formatCurrency(cadAmount)} CAD`;
            
            // Determine if declaration is required
            const declarationRequired = cadAmount >= threshold;
            document.getElementById('declarationRequired').textContent = 
                declarationRequired ? 
                `YES - Above $${threshold.toLocaleString()} CAD` : 
                `NO - Below $${threshold.toLocaleString()} CAD`;
            document.getElementById('declarationRequired').style.color = 
                declarationRequired ? '#af3c43' : '#2e8540';
            
            // Generate document serial based on calculation
            generateDocumentSerial();
        }

        function formatCurrency(amount) {
            return '$' + amount.toLocaleString('en-CA', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function updateDocument() {
            const currency = document.getElementById('currencyType').value;
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const rate = exchangeRates[currency];
            const cadAmount = amount * rate;
            
            // Update document display
            document.getElementById('displayAmount').textContent = formatCurrency(amount);
            document.getElementById('displayCurrency').textContent = currency;
            document.getElementById('displayCadAmount').textContent = `${formatCurrency(cadAmount)} CAD`;
            document.getElementById('displayTotalCad').textContent = `${formatCurrency(cadAmount)} CAD`;
            
            // Update QR code with new data
            generateQRCode();
            
            // Show confirmation
            alert('Declaration document has been updated with new values.');
        }

        function resetForm() {
            document.getElementById('currencyType').value = 'USD';
            document.getElementById('amount').value = '30000';
            document.getElementById('instrumentType').value = 'cash';
            calculateTotal();
            updateDocument();
        }

        function generateDocumentSerial() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 100000).toString().padStart(5, '0');
            
            const serial = `FCA-${year}-${month}${day}-${random}`;
            document.getElementById('docSerial').textContent = serial;
            document.getElementById('secureSerial').textContent = serial;
            
            return serial;
        }

        function generateQRCode() {
            const serial = document.getElementById('docSerial').textContent;
            const amount = document.getElementById('displayCadAmount').textContent;
            const url = `https://verify.canada.ca/fintrac-cbsa?serial=${serial}&amount=${encodeURIComponent(amount)}`;
            
            document.getElementById('verificationUrl').textContent = url;
            
            // Clear previous QR code
            document.getElementById('qrCodeContainer').innerHTML = '';
            
            // Generate new QR code
            new QRCode(document.getElementById('qrCodeContainer'), {
                text: url,
                width: 200,
                height: 200,
                colorDark: '#26374a',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // PDF Export Functionality
        document.getElementById('exportPdfBtn').addEventListener('click', function() {
            const button = this;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
            button.disabled = true;

            const element = document.getElementById('documentForPdf');
            const serial = document.getElementById('docSerial').textContent;
            
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5],
                filename: `FINTRAC-CBSA_Declaration_${serial}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                },
                jsPDF: {
                    unit: 'in',
                    format: 'letter',
                    orientation: 'portrait',
                    hotfixes: ['px_scaling']
                }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Log the export
                console.log(`PDF exported: ${serial} at ${new Date().toISOString()}`);
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #2e8540;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 4px;
                    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;
                successMsg.innerHTML = '<i class="fas fa-check-circle"></i> PDF successfully generated!';
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    successMsg.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => document.body.removeChild(successMsg), 300);
                }, 3000);
            }).catch(err => {
                console.error('PDF generation error:', err);
                button.innerHTML = originalText;
                button.disabled = false;
                alert('Error generating PDF. Please try again.');
            });
        });

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Generate initial serial
            generateDocumentSerial();
            
            // Calculate initial totals
            calculateTotal();
            
            // Generate QR code
            generateQRCode();
            
            // Set current date
            const now = new Date();
            document.getElementById('docDate').textContent = 
                now.toISOString().split('T')[0];
            document.getElementById('signatureDate').textContent = 
                now.toISOString().split('T')[0];
            
            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            console.log('Government Verification Portal initialized successfully.');
        });

        // Form validation for amount input
        document.getElementById('amount').addEventListener('blur', function() {
            const value = parseFloat(this.value);
            if (value < 0) {
                this.value = '0';
                calculateTotal();
            }
            if (value > 1000000) {
                alert('For amounts over $1,000,000 CAD, additional documentation is required.');
            }
        });
    </script>
</body>
</html>
